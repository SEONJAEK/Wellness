<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-Mapper.dtd">
<mapper namespace="Graph">   
	
   <!-- resultMap은 db컬럼명과 vo의 필드값이 안 맞을 때 사용한다. -->
	<resultMap id="resultGraph" type="Graph"> 
		<id property="userId" column="USER_ID" />
		<result property="userName" column="USER_NAME"/>
		<result property="gender" column="GENDER"/>
		<result property="age" column="AGE"/>
		<result property="phone" column="PHONE"/>
		<result property="email" column="EMAIL"/>
		<result property="address" column="ADDRESS"/>
		<result property="is_admin" column="IS_ADMIN"/>
	</resultMap>
	
	

	<select id="selectGraph" resultMap="resultGraph">
		SELECT USER_ID, USER_NAME, GENDER,
		(select extract(year from sysdate) from dual)-USER_BIRTH1 + 1 AS AGE,PHONE,
		EMAIL, ADDRESS, IS_ADMIN FROM MEMBER_INFO
	</select>
	
	
	
	<!-- resultMap은 db컬럼명과 vo의 필드값이 안 맞을 때 사용한다. -->
	<resultMap id="graph1" type="Graph"> 
		<result property="count_male" column="COUNT_MALE"/>
		<result property="count_female" column="COUNT_FEMALE"/>
	</resultMap>
	<select id="graph1" resultMap="graph1">
		SELECT SUM(CASE WHEN Gender = 'M' THEN 1 ELSE 0 END) as COUNT_MALE,
      	SUM(CASE WHEN Gender = 'F' THEN 1 ELSE 0 END) as COUNT_FEMALE
	  	FROM member_info
	</select>
	
	
	<!--  
	<resultMap id="graph2" type="Graph"> 
		<result property="count_male" column="COUNT_MALE"/>
		<result property="count_female" column="COUNT_FEMALE"/>
	</resultMap>
	<select id="graph1" resultMap="graph1">
			SELECT SUM(CASE WHEN ((select extract(year from sysdate) from dual)-USER_BIRTH1+1)<=10 THEN 1 ELSE 0 END) as "10",
      	SUM(CASE WHEN ((select extract(year from sysdate) from dual)-USER_BIRTH1+1)>10 and ((select extract(year from sysdate) from dual)-USER_BIRTH1+1)<20 THEN 1 ELSE 0 END) as "20"
	  	FROM member_info WHERE GENDER='M'
	</select>
	-->
	
	
</mapper>